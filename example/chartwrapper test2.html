<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Google Chartwrapper Maps
    </title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="" rel="stylesheet">
    
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="../Scripts/google-maps-3-vs-1-0.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi?fake=.js"></script>
    <script type="text/javascript">
   google.load('visualization', '1', {packages: ['corechart']});
google.load('maps', '3.9', {other_params: "sensor=false"});
google.setOnLoadCallback(initialize);

function initialize() {
    var myOptions = {
        center: new google.maps.LatLng(38.099983, -80.683594),
        zoom: 10,
        mapTypeControl: true,
        mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
            position: google.maps.ControlPosition.TOP_RIGHT
        },
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.LARGE
        },
        streetViewControl: true,
        streetViewControlOptions: {
            position: google.maps.ControlPosition.LEFT_TOP
        },
        mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);
    var layer = new google.maps.FusionTablesLayer();
    updateLayerQuery(layer);
    layer.setMap(map);
    
    var pieChart = new google.visualization.ChartWrapper({
        containerId: "visualization",
        chartType: "ColumnChart",
        options: {
            colors: ['#0000CC', '#3399FF', '#66CC00', '#FFFF00', '#FF9933', '#FF0033'],
            legendTextStyle: {
                color: '#666666',
                fontSize: '11'
            },
            titleTextStyle: {
                color: '#006600',
                fontSize: '12'
            },
            titlePosition: 'out',
            legend: 'left',
            is3D: true,
            height: 150,
            width: 350,
            backgroundColor: 'none',
            tooltip: {
                textStyle: {
                    color: 'black'
                },
                showColorCode: true
            },
            pieSliceText: 'percentage',
            pieSliceTextStyle: {
                color: 'white',
                fontSize: '11'
            },
            chartArea: {
                top: '30',
                left: '5',
                height: "80%",
                width: "70%"
            }
        }
    });
    drawVisualization('Bear Branch');

    var query = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq=');
    query.setQuery('SELECT Site, CALK, MAGIC_CL50 FROM 3235688');
    query.send(function(response) {
        var data = response.getDataTable();
        var baseView = new google.visualization.DataView(data);
        baseView.setColumns([1, 2]);
        var scatter = new google.visualization.ChartWrapper({
            containerId: "scatter",
            chartType: "ScatterChart",
            dataTable: baseView,
            options: {
                width: 350,
                height: 300,
                titleX: 'ANC (ueq/L)',
                title: 'Site',
                titleTextStyle: {
                    color: '#006600',
                    fontSize: '12'
                },
                titleY: 'CL for ANC=50 (meq/m2/yr)',
                series: [{
                    pointSize: 5
                }, {
                    visibleInLegend: false,
                    pointSize: 10,
                    color: 'red'
                }],
                legend: {
                    position: 'none',
                    textStyle: {
                        color: 'blue',
                        fontSize: 12
                    }
                }
            }
        });

        var runOnce = google.visualization.events.addListener(scatter, 'ready', function() {
            google.maps.event.addListener(layer, 'click', function(e) {
                var Site = e.row['Site'].value;
                setScatterSelection(Site);
                drawVisualization(Site);
            });

            google.maps.event.addDomListener(document.getElementById('Site'), 'change', function() {
                var Site = this.value;
                updateLayerQuery(layer, Site);
                setScatterSelection(Site);
                drawVisualization(Site);
            });
            
            google.visualization.events.removeListener(runOnce);
        });
        
        setScatterSelection('Bear Branch');
        
        function setScatterSelection(site) {
            var row = data.getFilteredRows([{
                column: 0,
                value: site
            }])[0];
            var view = new google.visualization.DataView(baseView);
            view.setColumns([0, 1, {
                type: 'number',
                label: baseView.getColumnLabel(1),
                calc: function(dt, index) {
                    if (row == index) {
                        return dt.getValue(index, 1);
                    }
                    else {
                        return null;
                    }
            }}]);
            
            var ready = google.visualization.events.addListener(scatter, 'ready', function() {
                scatter.getChart().setSelection([{
                    row: row,
                    column: 2
                }]);
                google.visualization.events.removeListener(ready);
            });
            
            scatter.setDataTable(view);
            scatter.setOption('title', site);
            scatter.draw();
        };
    });
    
    function drawVisualization(Site) {
        var pieQuery = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq=');
        pieQuery.setQuery("SELECT Site, BCw, BCdep, Nup, Nimm, ANClimit, BCup FROM 3235688 WHERE Site = '" + Site + "'");
        pieQuery.send(function(response) {
            var baseData = response.getDataTable();
            
            var pieData = new google.visualization.DataTable();
            pieData.addColumn('string', baseData.getColumnLabel(0));
            pieData.addColumn('number', 'Value');
            
            for (var i = 1; i < baseData.getNumberOfColumns(); i++) {
                pieData.addRow([baseData.getColumnLabel(i), baseData.getValue(0, i)]);
            }
            
            pieChart.setOption('title', Site);
            pieChart.setDataTable(pieData);
            pieChart.draw();
            
            basePieData = null;
            pieData = null;
        });
    }
    
    function updateLayerQuery(layer) {
        layer.setOptions({
            query: {
                select: 'Site',
                from: '3235688'
            }
        });
    }
}


    </script>
</head>

<body>
    <div id="map_canvas" style="width: 500px; height: 400px;"></div>
    <div id="scatter"></div>
    <div id="visualization"></div>

    <form>
        <label>Name</label>
        <select id="Site">
            <option value="Bear Branch">Bear Branch</option>
            <option value="Bearpen Branch">Bearpen Branch</option>
            <option value="Bearwallow Run">Bearwallow Run</option>
            <option value="Beech Lick Run">Beech Lick Run</option>
            <option value="Belfast Creek">Belfast Creek</option>
            <option value="Big Hellcat Creek">Big Hellcat Creek</option>
            <option value="Big Mack Creek">Big Mack Creek</option>
            <option value="Black Run (Lower)">Black Run (Lower)</option>
            <option value="Brokenback Run">Brokenback Run</option>
            <option value="Buffalo Creek">Buffalo Creek</option>
            <option value="Butler Branch">Butler Branch</option>
            <option value="Clubhouse Run (Lower)">Clubhouse Run (Lower)</option>
            <option value="Clubhouse Run (Upper)">Clubhouse Run (Upper)</option>
            <option value="Coal Run (SAMI)">Coal Run (SAMI)</option>
            <option value="Coal Run">Coal Run</option>
            <option value="Condon Run">Condon Run</option>
            <option value="Cove Branch (1)">Cove Branch (1)</option>
            <option value="Cove Branch (2)">Cove Branch (2)</option>
            <option value="Crawford Run">Crawford Run</option>
            <option value="Deep Run">Deep Run</option>
            <option value="Elk Run">Elk Run</option>
            <option value="Fernow - WS10">Fernow - WS10</option>
            <option value="Fernow - WS13">Fernow - WS13</option>
            <option value="Fernow - WS4">Fernow - WS4</option>
            <option value="Fisher Spring Run">Fisher Spring Run</option>
            <option value="Gauley">Gauley</option>
            <option value="German River (Upper)">German River (Upper)</option>
            <option value="Hateful Run">Hateful Run</option>
            <option value="Hazel Run">Hazel Run</option>
            <option value="Hedricks Creek">Hedricks Creek</option>
            <option value="Hipes Branch">Hipes Branch</option>
            <option value="Hogback Branch">Hogback Branch</option>
            <option value="Johnson Run">Johnson Run</option>
            <option value="Laurel Br of Stony Cr">Laurel Br of Stony Cr</option>
            <option value="Laurel Run (4)">Laurel Run (4)</option>
            <option value="Laurel Run (5)">Laurel Run (5)</option>
            <option value="Laurel Run">Laurel Run</option>
            <option value="Left Fork Clover Run">Left Fork Clover Run</option>
            <option value="Lewis Fork">Lewis Fork</option>
            <option value="Little Cove Creek">Little Cove Creek</option>
            <option value="Little Hellgate Creek">Little Hellgate Creek</option>
            <option value="Little Mill Creek">Little Mill Creek</option>
            <option value="Little Stonecoal Run">Little Stonecoal Run</option>
            <option value="Little Stony Cr (L)">Little Stony Cr (L)</option>
            <option value="Little Tumbling Creek">Little Tumbling Creek</option>
            <option value="Little Walker Cr">Little Walker Cr</option>
            <option value="Lost Run">Lost Run</option>
            <option value="Mare Run">Mare Run</option>
            <option value="Matts Creek">Matts Creek</option>
            <option value="Meadow Run">Meadow Run</option>
            <option value="Moss Run">Moss Run</option>
            <option value="NF Stony Creek">NF Stony Creek</option>
            <option value="NNT Glade Creek">NNT Glade Creek</option>
            <option value="No Business Creek">No Business Creek</option>
            <option value="NoName Trib Gap Cr">NoName Trib Gap Cr</option>
            <option value="NoName Trib SF Chry R">NoName Trib SF Chry R</option>
            <option value="NoName Trib Stny Cr 1">NoName Trib Stny Cr 1</option>
            <option value="Noname Trib Stny Cr 2">Noname Trib Stny Cr 2</option>
            <option value="North Fork Cherry (L)">North Fork Cherry (L)</option>
            <option value="North Fork Cherry (U)">North Fork Cherry (U)</option>
            <option value="North Fork Dry Run">North Fork Dry Run</option>
            <option value="North River">North River</option>
            <option value="NTN Laurel Run">NTN Laurel Run</option>
            <option value="Otter Creek (Upper)">Otter Creek (Upper)</option>
            <option value="Otter Creek">Otter Creek</option>
            <option value="Paine Run">Paine Run</option>
            <option value="Panther Run">Panther Run</option>
            <option value="Pine Swamp Branch">Pine Swamp Branch</option>
            <option value="Porters Creek">Porters Creek</option>
            <option value="Raccoon Branch">Raccoon Branch</option>
            <option value="Ragged Run">Ragged Run</option>
            <option value="Ramseys Draft">Ramseys Draft</option>
            <option value="Red Creek">Red Creek</option>
            <option value="Right Fork Clover Run">Right Fork Clover Run</option>
            <option value="Roaring Fork (Lower)">Roaring Fork (Lower)</option>
            <option value="Roaring Fork (Upper)">Roaring Fork (Upper)</option>
            <option value="Rose River">Rose River</option>
            <option value="Shawvers Run">Shawvers Run</option>
            <option value="St. Marys R (Lower)">St. Marys R (Lower)</option>
            <option value="St. Marys R (Middle)">St. Marys R (Middle)</option>
            <option value="Staunton River">Staunton River</option>
            <option value="Stonecoal Run (R Br)">Stonecoal Run (R Br)</option>
            <option value="Sugartree Branch SMR">Sugartree Branch SMR</option>
            <option value="Sulphur Spring Creek">Sulphur Spring Creek</option>
            <option value="Thunderstruck Creek">Thunderstruck Creek</option>
            <option value="Two Mile Run 2">Two Mile Run 2</option>
            <option value="Unnamed 1">Unnamed 1</option>
            <option value="Unnamed 2">Unnamed 2</option>
            <option value="White Oak Canyon R">White Oak Canyon R</option>
            <option value="White Oak Fork">White Oak Fork</option>
            <option value="White Oak Run">White Oak Run</option>
            <option value="Wolf Run">Wolf Run</option>

        </select>
    </form>
</body>

</html>
